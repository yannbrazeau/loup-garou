<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Loup-Garou (smartphone)</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:12px;background:#f6f6f6}
    h1{font-size:18px;margin:0 0 10px}
    .panel{background:#fff;border:1px solid #ddd;border-radius:12px;padding:12px;margin:10px 0}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    button{padding:10px 12px;border:0;border-radius:10px;background:#111;color:#fff;font-weight:700}
    button.secondary{background:#e9e9e9;color:#111}
    input,select{padding:10px;border-radius:10px;border:1px solid #ddd;background:#fff}
    .pill{border:1px solid #ddd;background:#fff;border-radius:999px;padding:6px 10px;font-size:13px}
    .big{font-size:22px;font-weight:800}
    .muted{opacity:.75}
    .list{display:grid;gap:8px}
    .card{border:1px solid #ddd;border-radius:12px;background:#fafafa;padding:10px}
  </style>
</head>
<body>
<h1>üê∫ Loup-Garou ‚Äî version smartphone</h1>

<div class="panel" id="setup">
  <div class="row">
    <div>
      <div class="muted">Nombre de joueurs</div>
      <input id="nPlayers" type="number" min="5" max="30" value="8"/>
    </div>
    <div>
      <div class="muted">Loups-garous</div>
      <input id="nWolves" type="number" min="1" max="10" value="2"/>
    </div>
    <div>
      <div class="muted">R√¥les sp√©ciaux</div>
      <select id="specials">
        <option value="basic" selected>Voyante + Sorci√®re</option>
        <option value="seer">Voyante seulement</option>
        <option value="witch">Sorci√®re seulement</option>
        <option value="none">Aucun</option>
      </select>
    </div>
  </div>
  <div class="row" style="margin-top:10px">
    <button onclick="start()">D√©marrer</button>
    <span class="pill" id="setupHint"></span>
  </div>
</div>

<div class="panel" id="reveal" style="display:none">
  <div class="row" style="justify-content:space-between">
    <div class="pill"><b>Joueur</b> <span id="pIndex"></span>/<span id="pTotal"></span></div>
    <button class="secondary" onclick="hideRole()">Cacher</button>
  </div>
  <div style="margin-top:10px" class="big" id="roleName">‚Äî</div>
  <div class="muted" id="roleHint" style="margin-top:6px"></div>
  <div class="row" style="margin-top:12px">
    <button onclick="showRole()">Voir mon r√¥le</button>
    <button class="secondary" onclick="nextPlayer()">Joueur suivant</button>
  </div>
</div>

<div class="panel" id="game" style="display:none">
  <div class="row" style="justify-content:space-between">
    <div class="pill"><b>Phase :</b> <span id="phase">Nuit</span></div>
    <div class="pill"><b>Tour :</b> <span id="round">1</span></div>
  </div>

  <div class="panel" style="background:#fafafa">
    <div class="big" id="stepTitle">La nuit tombe‚Ä¶</div>
    <div class="muted" id="stepText" style="margin-top:6px"></div>
    <div class="row" style="margin-top:10px">
      <button onclick="nextStep()">Continuer</button>
      <button class="secondary" onclick="resetGame()">Recommencer</button>
    </div>
  </div>

  <div class="panel">
    <div class="row" style="justify-content:space-between">
      <b>Joueurs en vie</b>
      <span class="muted">(appuie pour marquer mort/vivant)</span>
    </div>
    <div class="list" id="aliveList" style="margin-top:10px"></div>
  </div>
</div>

<script>
let state=null;

function start(){
  const n = clamp(parseInt(document.getElementById("nPlayers").value,10), 5, 30);
  const w = clamp(parseInt(document.getElementById("nWolves").value,10), 1, 10);
  const specials = document.getElementById("specials").value;

  const roles = [];
  for(let i=0;i<w;i++) roles.push("Loup-garou");

  if(specials==="basic" || specials==="seer") roles.push("Voyante");
  if(specials==="basic" || specials==="witch") roles.push("Sorci√®re");

  while(roles.length < n) roles.push("Villageois");

  shuffle(roles);

  state = {
    n, w, specials,
    roles,
    player: 0,
    revealed: false,
    alive: Array.from({length:n}, ()=>true),
    round: 1,
    phase: "Nuit",
    step: 0,
    witchHeal: (specials==="basic"||specials==="witch") ? true : false,
    witchKill: (specials==="basic"||specials==="witch") ? true : false
  };

  document.getElementById("setup").style.display="none";
  document.getElementById("reveal").style.display="block";
  document.getElementById("pTotal").textContent = n;
  updateReveal();
}

function updateReveal(){
  document.getElementById("pIndex").textContent = state.player+1;
  hideRole();
}

function showRole(){
  const r = state.roles[state.player];
  document.getElementById("roleName").textContent = r;
  document.getElementById("roleHint").textContent = hintFor(r);
  state.revealed = true;
}

function hideRole(){
  document.getElementById("roleName").textContent = "‚Äî";
  document.getElementById("roleHint").textContent = "Passe le t√©l√©phone au joueur concern√©, puis appuie sur ‚ÄúVoir mon r√¥le‚Äù.";
  state.revealed = false;
}

function nextPlayer(){
  if(state.player < state.n-1){
    state.player++;
    updateReveal();
  } else {
    // start game
    document.getElementById("reveal").style.display="none";
    document.getElementById("game").style.display="block";
    renderAlive();
    renderStep();
  }
}

function hintFor(r){
  if(r==="Loup-garou") return "La nuit, vous vous mettez d‚Äôaccord pour √©liminer un villageois.";
  if(r==="Voyante") return "Chaque nuit, vous pouvez d√©couvrir le r√¥le d‚Äôun joueur.";
  if(r==="Sorci√®re") return "Vous avez 1 potion de soin et 1 potion de mort (une seule fois chacune).";
  return "Survivez, d√©battez, votez, et √©liminez les loups.";
}

function renderAlive(){
  const list = document.getElementById("aliveList");
  list.innerHTML="";
  for(let i=0;i<state.n;i++){
    const div = document.createElement("div");
    div.className="card";
    div.style.cursor="pointer";
    div.innerHTML = `<b>Joueur ${i+1}</b> ‚Äî ${state.alive[i] ? "‚úÖ Vivant" : "‚ò†Ô∏è Mort"}`;
    div.onclick = ()=>{ state.alive[i]=!state.alive[i]; renderAlive(); };
    list.appendChild(div);
  }
}

function renderStep(){
  document.getElementById("phase").textContent = state.phase;
  document.getElementById("round").textContent = state.round;

  const steps = buildSteps();
  const cur = steps[state.step] || null;

  if(!cur){
    // switch phase
    if(state.phase==="Nuit"){
      state.phase="Jour";
      state.step=0;
    } else {
      state.phase="Nuit";
      state.round++;
      state.step=0;
    }
    renderStep();
    return;
  }

  document.getElementById("stepTitle").textContent = cur.title;
  document.getElementById("stepText").textContent = cur.text;
}

function nextStep(){
  state.step++;
  renderStep();
}

function buildSteps(){
  if(state.phase==="Nuit"){
    const s = [];
    s.push({title:"üåô La nuit tombe", text:"Tout le village s‚Äôendort. Le MJ guide les √©tapes."});
    s.push({title:"üê∫ Loups-garous", text:"Les loups se r√©veillent et d√©signent une victime (silencieusement)."});
    if(state.specials==="basic" || state.specials==="seer"){
      s.push({title:"üîÆ Voyante", text:"La voyante se r√©veille et demande le r√¥le d‚Äôun joueur au MJ."});
    }
    if(state.specials==="basic" || state.specials==="witch"){
      const healTxt = state.witchHeal ? "‚úÖ Potion de soin dispo." : "‚ùå Potion de soin d√©j√† utilis√©e.";
      const killTxt = state.witchKill ? "‚úÖ Potion de mort dispo." : "‚ùå Potion de mort d√©j√† utilis√©e.";
      s.push({title:"üß™ Sorci√®re", text:`La sorci√®re se r√©veille. ${healTxt} ${killTxt} D√©cidez d‚Äôutiliser une potion.`});
      s.push({title:"üß™ Sorci√®re (MJ)", text:"Si une potion est utilis√©e, pense √† marquer la victime ou le sauvetage, puis continue."});
    }
    s.push({title:"üåÖ R√©veil", text:"Tout le monde se r√©veille. Le MJ annonce ce qui s‚Äôest pass√© cette nuit."});
    return s;
  } else {
    return [
      {title:"‚òÄÔ∏è D√©bat", text:"Les joueurs discutent, accusent, se d√©fendent."},
      {title:"üó≥Ô∏è Vote", text:"Tout le monde vote pour √©liminer un joueur (majorit√©)."},
      {title:"‚úÖ Fin de journ√©e", text:"Marque le joueur √©limin√© (mort), puis on repart pour la nuit."},
    ];
  }
}

function resetGame(){
  location.reload();
}

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}
function clamp(x,min,max){ return Math.max(min, Math.min(max, x)); }
</script>
</body>
</html>
